<!-- public/index.html -->
<!DOCTYPE html>
<html>
<head>
  <title>Real GPS Tracker</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>#map{height:100vh;width:100%;margin:0}</style>
</head>
<body>
  <div id="map"></div>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([-13.1339, 27.8493], 10);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    let marker;

    // Extract device name from User-Agent
    function getDeviceName() {
      const ua = navigator.userAgent;
      if (/android/i.test(ua)) return 'Android Device';
      if (/iphone/i.test(ua)) return 'iPhone';
      if (/ipad/i.test(ua)) return 'iPad';
      if (/windows/i.test(ua)) return 'Windows PC';
      if (/macintosh|mac os x/i.test(ua)) return 'Mac Device';
      return 'Unknown Device';
    }
    
    const phoneName = getDeviceName();

    function sendLocation(lat, lng) {
      fetch('/api/gps', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ latitude: lat, longitude: lng, phoneName: phoneName })
      }).catch(e => console.error('Error:', e));
    }

    navigator.geolocation.watchPosition(
      pos => {
        const lat = pos.coords.latitude, lng = pos.coords.longitude;
        if (marker) marker.remove();
        marker = L.marker([lat, lng]).addTo(map);
        map.setView([lat, lng], 15);
        sendLocation(lat, lng);
      },
      err => alert('GPS Error: ' + err.message),
      { enableHighAccuracy: true }
    );
  </script>
</body>
</html>
